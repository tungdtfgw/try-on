# US-02: Cập nhật hồ sơ với ảnh toàn thân, chiều cao/cân nặng

## Bối cảnh
- Epic: Thiết lập hồ sơ khách hàng.
- Vai trò: Người dùng cuối (đã đăng nhập).
- Mục tiêu: Cập nhật hồ sơ cá nhân với ảnh chân dung toàn thân và thông số cơ thể để hệ thống dùng làm mẫu thử đồ.

## Phạm vi
- Xem và cập nhật hồ sơ: tên hiển thị (tùy chọn), chiều cao, cân nặng; email hiển thị (khóa, không sửa nếu dùng cho login).
- Upload ảnh chân dung toàn thân chuẩn, lưu vào Supabase Storage, gắn URL vào hồ sơ.
- Bắt buộc đăng nhập mới truy cập trang hồ sơ.

## Luồng chính (happy path)
- Người dùng (đã login) mở trang hồ sơ → client gọi API lấy hồ sơ hiện tại → hiển thị form.
- Người dùng nhập/điều chỉnh chiều cao, cân nặng, tên hiển thị (nếu có).
- Người dùng upload ảnh toàn thân (định dạng hợp lệ, đúng kích thước/ratio khuyến nghị) → client kiểm tra sơ bộ (loại file, dung lượng).
- Người dùng bấm lưu → client gửi dữ liệu + upload ảnh (nếu có) → server validate → lưu profile + URL ảnh → trả kết quả thành công → UI thông báo và hiển thị dữ liệu mới.

## Luồng lỗi cần xử lý
- Chưa đăng nhập hoặc token hết hạn → redirect/login yêu cầu đăng nhập lại.
- File ảnh sai loại (không phải jpg/jpeg/png) hoặc vượt dung lượng cho phép.
- Ảnh không phải toàn thân/không đúng ratio khuyến nghị → hiển thị hướng dẫn chọn ảnh đúng (không cần CV model, chỉ kiểm tra sơ bộ ratio/dimensions).
- Chiều cao/cân nặng không hợp lệ (thiếu, ngoài khoảng, không phải số).
- Lỗi upload Storage hoặc lỗi mạng/server → thông báo thân thiện, không lộ chi tiết kỹ thuật.

## Dữ liệu & validate gợi ý
- Chiều cao (cm): số, 100–250.
- Cân nặng (kg): số, 30–250.
- Ảnh toàn thân: loại jpg/jpeg/png; dung lượng ≤ 5MB; ratio khuyến nghị 3:4 hoặc 9:16; min dimension khuyến nghị ≥ 720px chiều ngắn; chỉ 1 ảnh duy nhất.
- Email: hiển thị từ hồ sơ/auth, không chỉnh sửa trên màn hình này (tránh sai lệch tài khoản đăng nhập).

## Acceptance Criteria (kết hợp sprint backlog)
- Chỉ người dùng đã đăng nhập mới truy cập/ghi hồ sơ.
- Người dùng xem được hồ sơ hiện tại (tên hiển thị nếu có, chiều cao, cân nặng, URL ảnh).
- Cập nhật chiều cao/cân nặng hợp lệ và lưu thành công; validation hiển thị rõ ràng khi sai.
- Upload ảnh toàn thân thành công, lưu vào Supabase Storage; URL được lưu trong hồ sơ.
- Thay ảnh mới sẽ thay thế ảnh cũ trong hồ sơ (có thể xóa ảnh cũ nếu quy định).
- Thông báo lỗi/success nhất quán; không lộ thông tin hệ thống.

## Phi chức năng
- Bảo mật: xác thực JWT, kiểm tra token trước khi đọc/ghi; không log dữ liệu nhạy cảm.
- Storage: cấu hình quyền truy cập phù hợp (public/private tùy thiết kế), không để lộ token nội bộ.
- CORS đúng origin; phản hồi nhanh, degrade gracefully trên mạng yếu.
- UI thân thiện, hướng dẫn chọn ảnh rõ ràng; hoạt động tốt trên desktop/mobile cơ bản.
